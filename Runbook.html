<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support L1/L2 Runbook Assistant</title>
    <style>
        :root { --primary: #004b87; --bg: #f4f7f6; --card: #ffffff; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); color: #333; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 800px; background: var(--card); padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { color: var(--primary); text-align: center; border-bottom: 2px solid #eee; padding-bottom: 15px; }
        .step-box { border: 1px solid #ddd; border-left: 5px solid var(--primary); padding: 15px; margin-bottom: 20px; border-radius: 4px; background: #fafafa; }
        label { display: block; font-weight: bold; margin-top: 10px; margin-bottom: 5px; color: #555; }
        input[type="text"], textarea, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 14px; }
        button { background-color: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 10px; transition: 0.3s; }
        button:hover { background-color: #003366; }
        .hidden { display: none; }
        .output-area { background: #2d2d2d; color: #50fa7b; padding: 15px; border-radius: 5px; font-family: 'Courier New', Courier, monospace; margin-top: 20px; white-space: pre-wrap; }
        .tag { display: inline-block; background: #e1ecf4; color: #39739d; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ¦ L1/L2 Support Runbook</h1>
    
    <div class="step-box">
        <h3>1. è¼¸å…¥ Ticket è³‡è¨Š</h3>
        <label>ServiceNow Incident Title (æ¨™é¡Œ):</label>
        <input type="text" id="incidentTitle" placeholder="ä¾‹å¦‚: Mobile App Transfer Timeout / ç¶²éŠ€ç™»å…¥å¤±æ•—..." oninput="detectScenario()">
        <p style="font-size: 12px; color: #888;">ç³»çµ±æœƒæ ¹æ“šæ¨™é¡Œé—œéµå­—è‡ªå‹•æ¨è–¦ SOP</p>
    </div>

    <div id="playbookArea" class="hidden">
        <div class="step-box">
            <h3 id="scenarioName">åµæ¸¬åˆ°çš„å ´æ™¯ï¼šé€šç”¨æª¢æŸ¥</h3>
            <span class="tag">SOP åŸ·è¡Œä¸­</span>
            
            <div id="dynamicContent">
                </div>
        </div>
        <button onclick="generateResponse()">ç”Ÿæˆ ServiceNow å›è¦†</button>
    </div>

    <div id="resultArea" class="hidden">
        <h3>ğŸ“‹ è¤‡è£½ä¸¦è²¼ä¸Šåˆ° ServiceNow:</h3>
        <div class="output-area" id="finalOutput"></div>
        <button onclick="copyToClipboard()">è¤‡è£½å…§å®¹</button>
    </div>
</div>

<script>
    // å®šç¾©å„ç¨®å•é¡Œçš„ SOP æ¨¡æ¿
    const scenarios = {
        'timeout': {
            name: 'äº¤æ˜“é€¾æ™‚ / Pending (Transaction Timeout)',
            steps: [
                { label: 'å—å½±éŸ¿çš„äº¤æ˜“åºè™Ÿ (Transaction IDs)', id: 'txnId', placeholder: 'e.g., TXN12345678, TXN87654321' },
                { label: 'æŸ¥è©¢ Application Log çš„çµæœ', id: 'logCheck', placeholder: 'e.g., Log shows connection timeout to Core Banking System' },
                { label: 'æŸ¥è©¢ Database ç‹€æ…‹ (æ˜¯å¦å·²æ‰£æ¬¾?)', id: 'dbStatus', placeholder: 'e.g., Status is PENDING in DB, no record in destination' },
                { label: 'æ¡å–è¡Œå‹• (Action Taken)', id: 'action', placeholder: 'e.g., Re-triggered via Admin Console OR Escaled to L3' }
            ],
            template: (data) => `[Analysis]\n- Incident triggered by transaction timeout alerts.\n- Affected Txn IDs: ${data.txnId}\n\n[Investigation]\n- Application Log Analysis: ${data.logCheck}\n- Database Status Verification: ${data.dbStatus}\n\n[Action Taken]\n- ${data.action}\n- Verified system health, currently stable.\n\n[Next Step]\n- Monitor for next 30 mins.`
        },
        'login': {
            name: 'ç”¨æˆ¶ç™»å…¥å¤±æ•— (Login Failure)',
            steps: [
                { label: 'ç”¨æˆ¶ ID (User ID)', id: 'userId', placeholder: 'e.g., U100200' },
                { label: 'éŒ¯èª¤ä»£ç¢¼ (Error Code displayed)', id: 'errCode', placeholder: 'e.g., ERR_AUTH_005' },
                { label: 'AD/LDAP ç‹€æ…‹æª¢æŸ¥', id: 'adStatus', placeholder: 'e.g., Account is LOCKED in Active Directory' },
                { label: 'è§£æ±ºæ–¹æ¡ˆ', id: 'resolution', placeholder: 'e.g., Unlocked account via AD Manager' }
            ],
            template: (data) => `[Issue]\n- User reported login failure.\n- User ID: ${data.userId}\n- Error Code: ${data.errCode}\n\n[Diagnosis]\n- Checked Identity Provider (AD/LDAP): ${data.adStatus}\n\n[Resolution]\n- ${data.resolution}\n- Confirmed user can login successfully now.\n\n[Status]\n- Resolved.`
        },
        'default': {
            name: 'ä¸€èˆ¬é€šç”¨æª¢æŸ¥ (General Issue)',
            steps: [
                { label: 'å•é¡Œæè¿° (Issue Description)', id: 'desc', placeholder: 'è©³ç´°æè¿°å•é¡Œ...' },
                { label: 'åˆæ­¥èª¿æŸ¥ (Investigation)', id: 'investigation', placeholder: 'æŸ¥äº†ä»€éº¼ Log? çœ‹åˆ°ä»€éº¼?' },
                { label: 'è™•ç†æ–¹å¼ (Action)', id: 'action', placeholder: 'åšäº†ä»€éº¼è™•ç½®?' }
            ],
            template: (data) => `[Summary]\n${data.desc}\n\n[Investigation Log]\n${data.investigation}\n\n[Resolution/Action]\n${data.action}`
        }
    };

    let currentScenario = 'default';

    function detectScenario() {
        const title = document.getElementById('incidentTitle').value.toLowerCase();
        const area = document.getElementById('playbookArea');
        const content = document.getElementById('dynamicContent');
        const titleHeader = document.getElementById('scenarioName');
        
        area.classList.remove('hidden');
        document.getElementById('resultArea').classList.add('hidden');

        // ç°¡å–®çš„é—œéµå­—æ¯”å°é‚è¼¯
        if (title.includes('timeout') || title.includes('é€¾æ™‚') || title.includes('pending')) {
            currentScenario = 'timeout';
        } else if (title.includes('login') || title.includes('ç™»å…¥') || title.includes('lock')) {
            currentScenario = 'login';
        } else {
            currentScenario = 'default';
        }

        // æ¸²æŸ“å°æ‡‰çš„è¼¸å…¥æ¡†
        const scenarioData = scenarios[currentScenario];
        titleHeader.innerText = "åµæ¸¬åˆ°çš„å ´æ™¯ï¼š " + scenarioData.name;
        
        // é¿å…é‡è¤‡æ¸²æŸ“ï¼Œåªæœ‰åˆ‡æ›å ´æ™¯æ™‚æ‰é‡ç¹ª
        if (content.dataset.scenario !== currentScenario) {
            content.innerHTML = '';
            scenarioData.steps.forEach(step => {
                content.innerHTML += `
                    <div style="margin-bottom:15px;">
                        <label>${step.label}</label>
                        <input type="text" id="${step.id}" placeholder="${step.placeholder}">
                    </div>
                `;
            });
            content.dataset.scenario = currentScenario;
        }
    }

    function generateResponse() {
        const scenarioData = scenarios[currentScenario];
        let data = {};
        
        // æ”¶é›†è¼¸å…¥çš„è³‡æ–™
        scenarioData.steps.forEach(step => {
            data[step.id] = document.getElementById(step.id).value || '(None)';
        });

        // ç”¢ç”Ÿæ–‡å­—
        const responseText = scenarioData.template(data);
        
        document.getElementById('finalOutput').innerText = responseText;
        document.getElementById('resultArea').classList.remove('hidden');
    }

    function copyToClipboard() {
        const text = document.getElementById('finalOutput').innerText;
        navigator.clipboard.writeText(text).then(() => {
            alert('å…§å®¹å·²è¤‡è£½ï¼è«‹è²¼ä¸Šåˆ° ServiceNow Work Notes');
        });
    }
</script>

</body>
</html>
